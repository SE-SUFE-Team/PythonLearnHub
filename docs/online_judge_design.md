# Online Judge ç³»ç»Ÿè®¾è®¡æ–‡æ¡£

## 1. æ¦‚è¿°

### 1.1 ç³»ç»Ÿç®€ä»‹
æœ¬ Online Judge (OJ) ç³»ç»Ÿæ˜¯ Python å­¦ä¹ å¹³å°çš„æ ¸å¿ƒåŠŸèƒ½æ¨¡å—ï¼Œä¸ºç”¨æˆ·æä¾›ç¼–ç¨‹é¢˜ç›®ç»ƒä¹ ã€ä»£ç æäº¤ã€è‡ªåŠ¨åˆ¤é¢˜ç­‰åŠŸèƒ½ã€‚ç³»ç»Ÿæ”¯æŒå¤šæµ‹è¯•ç”¨ä¾‹éªŒè¯ï¼Œå®æ—¶åé¦ˆä»£ç æ‰§è¡Œç»“æœã€‚

### 1.2 ä¸»è¦åŠŸèƒ½
- é¢˜ç›®ç®¡ç†ï¼šæµè§ˆã€æŸ¥çœ‹é¢˜ç›®è¯¦æƒ…
- ä»£ç æäº¤ï¼šåœ¨çº¿ç¼–å†™å’Œæäº¤ä»£ç 
- è‡ªåŠ¨åˆ¤é¢˜ï¼šå¤šæµ‹è¯•ç”¨ä¾‹éªŒè¯
- æäº¤å†å²ï¼šæŸ¥çœ‹å†å²æäº¤è®°å½•

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æŠ€æœ¯æ ˆ
- **åç«¯æ¡†æ¶**: Flask
- **æ•°æ®åº“**: SQLite (SQLAlchemy ORM)
- **åˆ¤é¢˜å¼•æ“**: è‡ªå®šä¹‰ Judge Engine (utils.judge)
- **ä»£ç æ‰§è¡Œ**: å®‰å…¨æ²™ç®±ç¯å¢ƒ (utils.safe_executor)

### 2.2 æ¨¡å—åˆ’åˆ†
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯ç”¨æˆ·ç•Œé¢                â”‚
â”‚         (oj_home.html)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Flask è·¯ç”±å±‚                â”‚
â”‚    (API Endpoints + Page Routes)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
      â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ¤é¢˜å¼•æ“  â”‚      â”‚  æ•°æ®æ¨¡å‹  â”‚
â”‚  Judge   â”‚      â”‚ Problem  â”‚
â”‚  Engine  â”‚      â”‚Submissionâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                 â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ•°æ®å­˜å‚¨å±‚  â”‚
        â”‚ (SQLite DB)  â”‚
        â”‚ (JSON Files) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. æ•°æ®åº“è®¾è®¡

### 3.1 æ•°æ®å­˜å‚¨æ¶æ„

ç³»ç»Ÿé‡‡ç”¨**æ··åˆå­˜å‚¨æ¶æ„**ï¼š
- **é¢˜ç›®æ•°æ®**ï¼šå­˜å‚¨åœ¨ JSON æ–‡ä»¶ä¸­ï¼ˆ`Data/problem_*.json` å’Œ `Data/test_case_*.json`ï¼‰ï¼Œä¾¿äºå¿«é€Ÿè¿­ä»£å’Œç‰ˆæœ¬ç®¡ç†
- **æäº¤è®°å½•**ï¼šå­˜å‚¨åœ¨ SQLite æ•°æ®åº“ä¸­ï¼Œä¿è¯æ•°æ®æŒä¹…åŒ–å’ŒæŸ¥è¯¢æ•ˆç‡

### 3.2 Problem è¡¨ (é¢˜ç›®ä¿¡æ¯)

è™½ç„¶é¢˜ç›®æ•°æ®ä¸»è¦å­˜å‚¨åœ¨ JSON æ–‡ä»¶ä¸­ï¼Œä½†æ•°æ®åº“è¡¨å·²å®šä¹‰ï¼Œæ”¯æŒæœªæ¥æ‰©å±•ä¸ºæ•°æ®åº“å­˜å‚¨ã€‚

**å®é™…å­—æ®µè®¾è®¡** (`models/problem.py`):
```python
class Problem(db.Model):
    __tablename__ = 'problems'
    
    id = db.Column(db.Integer, primary_key=True)
    title = db.Column(db.String(200), nullable=False)
    difficulty = db.Column(db.String(20))  # Easy/Medium/Hard
    description = db.Column(db.Text)
    created_at = db.Column(db.DateTime, default=datetime.now)
    
    # å…³ç³»ï¼šä¸€ä¸ªé¢˜ç›®å¯ä»¥æœ‰å¤šä¸ªæäº¤è®°å½•
    submissions = db.relationship('Submission', backref='problem', lazy=True)
```

**JSON æ–‡ä»¶æ ¼å¼** (`Data/problem_*.json`):
```json
{
  "id": 1,
  "title": "æœ€é•¿å›æ–‡å­ä¸²",
  "description": "ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²...",
  "example": {
    "input": "\"babad\"",
    "output": "\"bab\""
  },
  "function_name": "longestPalindrome"
}
```

**æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶æ ¼å¼** (`Data/test_case_*.json`):
```json
{
  "problem_id": 1,
  "testcases": [
    {
      "input": "'babad'",
      "expected_output": "bab"
    },
    {
      "input": "'cbbd'",
      "expected_output": "bb"
    }
  ]
}
```

### 3.3 Submission è¡¨ (æäº¤è®°å½•)

å­˜å‚¨ç”¨æˆ·çš„æ‰€æœ‰ä»£ç æäº¤è®°å½•ï¼Œæ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒæ•°æ®è¡¨ã€‚

**å®é™…å­—æ®µè®¾è®¡** (`models/problem.py`):
```python
class Submission(db.Model):
    __tablename__ = 'submissions'
    
    id = db.Column(db.Integer, primary_key=True)
    user_id = db.Column(db.Integer, db.ForeignKey('users.id'), nullable=False)
    problem_id = db.Column(db.Integer, db.ForeignKey('problems.id'), nullable=False)
    code = db.Column(db.Text, nullable=False)  # ç”¨æˆ·æäº¤çš„å®Œæ•´ä»£ç 
    status = db.Column(db.String(20))  # AC, WA, TLE, RE, CE
    passed_cases = db.Column(db.Integer, default=0)  # é€šè¿‡çš„æµ‹è¯•ç”¨ä¾‹æ•°
    total_cases = db.Column(db.Integer, default=0)  # æ€»æµ‹è¯•ç”¨ä¾‹æ•°
    error_message = db.Column(db.Text)  # JSONæ ¼å¼å­˜å‚¨å¤±è´¥ç”¨ä¾‹è¯¦æƒ…
    execution_time = db.Column(db.Float)  # æ‰§è¡Œæ—¶é—´(æ¯«ç§’)
    submitted_at = db.Column(db.DateTime, default=datetime.now)  # æäº¤æ—¶é—´
```

**å­—æ®µè¯´æ˜**:
- `status`: åˆ¤é¢˜çŠ¶æ€ç 
  - `AC`: Acceptedï¼ˆé€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼‰
  - `WA`: Wrong Answerï¼ˆç­”æ¡ˆé”™è¯¯ï¼‰
  - `TLE`: Time Limit Exceededï¼ˆè¶…æ—¶ï¼‰
  - `RE`: Runtime Errorï¼ˆè¿è¡Œæ—¶é”™è¯¯ï¼‰
  - `CE`: Compilation Errorï¼ˆç¼–è¯‘é”™è¯¯ï¼ŒPythonä¸­è¾ƒå°‘è§ï¼‰
- `error_message`: å­˜å‚¨å¤±è´¥ç”¨ä¾‹çš„è¯¦ç»†ä¿¡æ¯ï¼ˆJSONæ ¼å¼ï¼‰ï¼ŒåŒ…å«è¾“å…¥ã€æœŸæœ›è¾“å‡ºã€å®é™…è¾“å‡ºã€é”™è¯¯ä¿¡æ¯ç­‰
- `execution_time`: è®°å½•ä»£ç æ‰§è¡Œæ—¶é—´ï¼Œç”¨äºæ€§èƒ½åˆ†æ

**ç´¢å¼•ä¼˜åŒ–**:
```python
# å»ºè®®æ·»åŠ çš„ç´¢å¼•ï¼ˆå¯é€šè¿‡ SQLAlchemy è¿ç§»å®ç°ï¼‰
# CREATE INDEX idx_user_problem ON submissions(user_id, problem_id);
# CREATE INDEX idx_submitted_at ON submissions(submitted_at DESC);
# CREATE INDEX idx_status ON submissions(status);
```

### 3.4 æ•°æ®å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User   â”‚ 1     * â”‚  Submission  â”‚ *     1  â”‚ Problem  â”‚
â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚
â”‚ id (PK)  â”‚         â”‚ id (PK)      â”‚         â”‚ id (PK)  â”‚
â”‚ username â”‚         â”‚ user_id (FK) â”‚         â”‚ title    â”‚
â”‚ email    â”‚         â”‚ problem_id  â”‚         â”‚ desc     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ code        â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ status       â”‚
                     â”‚ passed_cases â”‚
                     â”‚ total_cases  â”‚
                     â”‚ exec_time    â”‚
                     â”‚ submitted_at â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³ç³»è¯´æ˜**:
- `User` ä¸ `Submission`: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥æœ‰å¤šä¸ªæäº¤è®°å½•
- `Problem` ä¸ `Submission`: ä¸€å¯¹å¤šå…³ç³»ï¼Œä¸€ä¸ªé¢˜ç›®å¯ä»¥æœ‰å¤šä¸ªæäº¤è®°å½•
- `Submission` é€šè¿‡å¤–é”®å…³è” `User` å’Œ `Problem`ï¼Œæ”¯æŒçº§è”æŸ¥è¯¢

---

## 4. API æ¥å£è®¾è®¡

### 4.1 è·å–é¢˜ç›®åˆ—è¡¨

**æ¥å£**: `GET /api/oj/problems`

**åŠŸèƒ½**: è·å–æ‰€æœ‰å¯ç”¨é¢˜ç›®çš„åˆ—è¡¨

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "problems": [
    {
      "id": "1",
      "title": "ä¸¤æ•°ä¹‹å’Œ",
      "description": "ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„å’Œç›®æ ‡å€¼ï¼Œæ‰¾å‡ºæ•°ç»„ä¸­å’Œä¸ºç›®æ ‡å€¼çš„ä¸¤ä¸ªæ•°..."
    },
    {
      "id": "2",
      "title": "å›æ–‡åˆ¤æ–­",
      "description": "åˆ¤æ–­ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯å¦ä¸ºå›æ–‡..."
    }
  ]
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "error": "è¯»å–é¢˜ç›®å¤±è´¥"
}
```

---

### 4.2 è·å–é¢˜ç›®è¯¦æƒ…

**æ¥å£**: `GET /api/oj/problem/<problem_id>`

**åŠŸèƒ½**: è·å–æŒ‡å®šé¢˜ç›®çš„è¯¦ç»†ä¿¡æ¯

**è·¯å¾„å‚æ•°**:
- `problem_id`: é¢˜ç›®ID (å­—ç¬¦ä¸²)

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "problem": {
    "id": "1",
    "title": "ä¸¤æ•°ä¹‹å’Œ",
    "description": "ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ nums å’Œä¸€ä¸ªç›®æ ‡å€¼ target...",
    "input_format": "ç¬¬ä¸€è¡ŒåŒ…å«æ•°ç»„å…ƒç´ ï¼Œç¬¬äºŒè¡ŒåŒ…å«ç›®æ ‡å€¼",
    "output_format": "è¾“å‡ºä¸¤ä¸ªç´¢å¼•ï¼Œç”¨ç©ºæ ¼åˆ†éš”",
    "examples": [
      {
        "input": "2 7 11 15\n9",
        "output": "0 1",
        "explanation": "nums[0] + nums[1] = 2 + 7 = 9"
      }
    ],
    "test_cases": [
      {
        "input": "2 7 11 15\n9",
        "expected_output": "0 1"
      }
    ]
  }
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "error": "é¢˜ç›®ä¸å­˜åœ¨"
}
```

---

### 4.3 æäº¤ä»£ç 

**æ¥å£**: `POST /api/oj/submit`

**åŠŸèƒ½**: æäº¤ä»£ç è¿›è¡Œåˆ¤é¢˜

**è¯·æ±‚å¤´**:
- `Content-Type: application/json`
- éœ€è¦ç™»å½•è®¤è¯

**è¯·æ±‚ä½“**:
```json
{
  "problem_id": "1",
  "code": "def solution(nums, target):\n    # ç”¨æˆ·ä»£ç \n    pass"
}
```

**å“åº”ç¤ºä¾‹ - é€šè¿‡æ‰€æœ‰æµ‹è¯•**:
```json
{
  "success": true,
  "submission_id": 12345,
  "result": {
    "success": true,
    "status": "Accepted",
    "passed": 10,
    "total": 10,
    "execution_time": 0.023,
    "message": "æ­å–œï¼é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹"
  }
}
```

**å“åº”ç¤ºä¾‹ - éƒ¨åˆ†é€šè¿‡**:
```json
{
  "success": true,
  "submission_id": 12346,
  "result": {
    "success": false,
    "status": "Wrong Answer",
    "passed": 7,
    "total": 10,
    "execution_time": 0.018,
    "failed_case": {
      "case_id": 8,
      "input": "1 2 3 4\n10",
      "expected": "æ— è§£",
      "actual": "IndexError: list index out of range"
    }
  }
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "error": "é¢˜ç›®IDå’Œä»£ç ä¸èƒ½ä¸ºç©º"
}
```

---

### 4.4 è·å–æäº¤å†å²

**æ¥å£**: `GET /api/oj/submissions`

**åŠŸèƒ½**: è·å–å½“å‰ç”¨æˆ·çš„æäº¤è®°å½•

**è¯·æ±‚å‚æ•°**:
- `problem_id` (å¯é€‰): ç­›é€‰æŒ‡å®šé¢˜ç›®çš„æäº¤è®°å½•

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "submissions": [
    {
      "id": 12346,
      "problem_id": "1",
      "status": "Wrong Answer",
      "passed_cases": 7,
      "total_cases": 10,
      "execution_time": 0.018,
      "submitted_at": "2024-01-15 14:30:25",
      "code": "def solution(nums, target):\n    ..."
    },
    {
      "id": 12345,
      "problem_id": "1",
      "status": "Accepted",
      "passed_cases": 10,
      "total_cases": 10,
      "execution_time": 0.023,
      "submitted_at": "2024-01-15 14:25:10",
      "code": "def solution(nums, target):\n    ..."
    }
  ]
}
```

---

### 4.5 æ¸…ç©ºæäº¤å†å²

**æ¥å£**: `POST /api/oj/submissions/clear`

**åŠŸèƒ½**: æ¸…ç©ºæŒ‡å®šé¢˜ç›®çš„æ‰€æœ‰æäº¤è®°å½•

**è¯·æ±‚ä½“**:
```json
{
  "problem_id": "1"
}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "message": "å·²æ¸…ç©º 15 æ¡æäº¤è®°å½•",
  "deleted_count": 15
}
```

**é”™è¯¯å“åº”**:
```json
{
  "success": false,
  "error": "ç¼ºå°‘é¢˜ç›®ID"
}
```

---

## 5. åç«¯è®¾è®¡è¯¦è§£

### 5.1 åˆ¤é¢˜å¼•æ“æ¶æ„

åˆ¤é¢˜å¼•æ“ (`utils/judge.py`) é‡‡ç”¨**å‡½æ•°æ¨¡å¼æ‰§è¡Œ**ï¼Œè€Œéç›´æ¥æ‰§è¡Œè„šæœ¬ï¼Œè¿™æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒè®¾è®¡äº®ç‚¹ã€‚

**æ ¸å¿ƒç±»**: `JudgeEngine`

**ä¸»è¦æ–¹æ³•**:
- `load_problem(problem_id)`: ä» JSON æ–‡ä»¶åŠ è½½é¢˜ç›®ä¿¡æ¯
- `load_testcases(problem_id)`: ä» JSON æ–‡ä»¶åŠ è½½æµ‹è¯•ç”¨ä¾‹
- `run_function_mode(code, function_name, test_input, time_limit)`: å‡½æ•°æ¨¡å¼æ‰§è¡Œä»£ç 
- `compare_output(user_output, expected_output)`: æ¯”è¾ƒè¾“å‡ºç»“æœ
- `judge(problem_id, code)`: ä¸»åˆ¤é¢˜å‡½æ•°

### 5.2 åˆ¤é¢˜æµç¨‹è¯¦è§£

```
å¼€å§‹
 â”‚
 â”œâ”€â†’ åŠ è½½é¢˜ç›®æ•°æ® (problem_*.json)
 â”‚    - è·å–é¢˜ç›®æè¿°ã€å‡½æ•°åã€ç¤ºä¾‹
 â”‚
 â”œâ”€â†’ åŠ è½½æµ‹è¯•ç”¨ä¾‹ (test_case_*.json)
 â”‚    - è·å–æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹çš„è¾“å…¥å’ŒæœŸæœ›è¾“å‡º
 â”‚
 â”œâ”€â†’ éå†æµ‹è¯•ç”¨ä¾‹ï¼ˆé¡ºåºæ‰§è¡Œï¼Œé‡åˆ°å¤±è´¥å³åœæ­¢ï¼‰
 â”‚    â”‚
 â”‚    â”œâ”€â†’ åˆ›å»ºå—é™æ‰§è¡Œç¯å¢ƒ
 â”‚    â”‚    - é™åˆ¶å†…ç½®å‡½æ•°ç™½åå•
 â”‚    â”‚    - ç¦æ­¢å±é™©æ“ä½œ
 â”‚    â”‚
 â”‚    â”œâ”€â†’ æ‰§è¡Œç”¨æˆ·ä»£ç 
 â”‚    â”‚    - ä½¿ç”¨ exec() æ‰§è¡Œä»£ç å®šä¹‰
 â”‚    â”‚    - æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
 â”‚    â”‚
 â”‚    â”œâ”€â†’ è°ƒç”¨ç”¨æˆ·å‡½æ•°
 â”‚    â”‚    - è§£ææµ‹è¯•ç”¨ä¾‹è¾“å…¥
 â”‚    â”‚    - è°ƒç”¨æŒ‡å®šå‡½æ•°å
 â”‚    â”‚    - æ•è·è¿”å›å€¼
 â”‚    â”‚
 â”‚    â”œâ”€â†’ æ¯”å¯¹è¾“å‡ºç»“æœ
 â”‚    â”‚    - ä½¿ç”¨ == è¿›è¡Œç²¾ç¡®æ¯”è¾ƒ
 â”‚    â”‚
 â”‚    â””â”€â†’ è®°å½•ç”¨ä¾‹ç»“æœ
 â”‚         - é€šè¿‡ï¼šç»§ç»­ä¸‹ä¸€ä¸ªç”¨ä¾‹
 â”‚         - å¤±è´¥ï¼šè®°å½•å¤±è´¥ä¿¡æ¯å¹¶åœæ­¢
 â”‚
 â”œâ”€â†’ ç»Ÿè®¡ç»“æœ
 â”‚    - é€šè¿‡ç”¨ä¾‹æ•° / æ€»ç”¨ä¾‹æ•°
 â”‚    - æ‰§è¡Œæ—¶é—´ï¼ˆå–æœ€å¤§å€¼ï¼‰
 â”‚    - åˆ¤é¢˜çŠ¶æ€
 â”‚
 â””â”€â†’ è¿”å›åˆ¤é¢˜ç»“æœ
```

### 5.3 å‡½æ•°æ¨¡å¼æ‰§è¡Œæœºåˆ¶

**æŠ€æœ¯äº®ç‚¹**: ç³»ç»Ÿé‡‡ç”¨å‡½æ•°æ¨¡å¼è€Œéè„šæœ¬æ¨¡å¼ï¼Œè¦æ±‚ç”¨æˆ·å®šä¹‰æŒ‡å®šåç§°çš„å‡½æ•°ã€‚

**æ‰§è¡Œæµç¨‹**:
```python
# 1. åˆ›å»ºå—é™çš„æ‰§è¡Œç¯å¢ƒ
exec_globals = {
    '__builtins__': {
        'len': len, 'range': range, 'list': list,
        'dict': dict, 'set': set, 'tuple': tuple,
        'str': str, 'int': int, 'float': float,
        # ... æ›´å¤šå®‰å…¨çš„å†…ç½®å‡½æ•°
    }
}

# 2. æ‰§è¡Œç”¨æˆ·ä»£ç ï¼ˆå®šä¹‰å‡½æ•°ï¼‰
exec(code, exec_globals)

# 3. æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
if function_name not in exec_globals:
    return {'error': f'å‡½æ•° {function_name} æœªå®šä¹‰'}

# 4. è§£ææµ‹è¯•ç”¨ä¾‹è¾“å…¥
args = eval(test_input, {"__builtins__": {}})

# 5. è°ƒç”¨ç”¨æˆ·å‡½æ•°
user_function = exec_globals[function_name]
output = user_function(*args)
```

**ä¼˜åŠ¿**:
- æ›´ç¬¦åˆç®—æ³•é¢˜ç›®çš„è§£é¢˜æ¨¡å¼
- ä¾¿äºæµ‹è¯•ç”¨ä¾‹çš„ç»Ÿä¸€ç®¡ç†
- é¿å…è„šæœ¬æ‰§è¡Œå¸¦æ¥çš„å‰¯ä½œç”¨
- æ›´å®¹æ˜“è¿›è¡Œç»“æœæ¯”å¯¹

### 5.4 åˆ¤é¢˜çŠ¶æ€ç 

| çŠ¶æ€ç  | è‹±æ–‡åç§° | ä¸­æ–‡è¯´æ˜ | è§¦å‘æ¡ä»¶ |
|-------|---------|---------|---------|
| AC | Accepted | é€šè¿‡æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ | æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹è¾“å‡ºåŒ¹é… |
| WA | Wrong Answer | ç­”æ¡ˆé”™è¯¯ | è¾“å‡ºä¸æœŸæœ›å€¼ä¸åŒ¹é… |
| TLE | Time Limit Exceeded | è¶…æ—¶ | æ‰§è¡Œæ—¶é—´è¶…è¿‡é™åˆ¶ï¼ˆé»˜è®¤1.0ç§’ï¼‰ |
| RE | Runtime Error | è¿è¡Œæ—¶é”™è¯¯ | ä»£ç æ‰§è¡ŒæŠ›å‡ºå¼‚å¸¸ |
| CE | Compilation Error | ç¼–è¯‘é”™è¯¯ | Pythonä¸­è¾ƒå°‘è§ï¼Œé€šå¸¸ä¸ºè¯­æ³•é”™è¯¯ |

### 5.5 å®‰å…¨æœºåˆ¶

**ä»£ç æ‰§è¡Œé™åˆ¶** (`utils/judge.py`):
```python
# æ—¶é—´é™åˆ¶: å¯é…ç½®ï¼ˆé»˜è®¤1.0ç§’ï¼‰
time_limit = problem.get('time_limit', 1.0)

# å†…ç½®å‡½æ•°ç™½åå•: ä»…å…è®¸å®‰å…¨çš„å†…ç½®å‡½æ•°
safe_builtins = {
    'len', 'range', 'list', 'dict', 'set', 'tuple',
    'str', 'int', 'float', 'bool', 'map', 'filter',
    'sorted', 'sum', 'max', 'min', 'abs', 'enumerate',
    'zip', 'round'
}
```

**å®‰å…¨ç­–ç•¥**:
- **å—é™æ‰§è¡Œç¯å¢ƒ**: ä½¿ç”¨è‡ªå®šä¹‰çš„ `__builtins__` å­—å…¸ï¼Œä»…åŒ…å«å®‰å…¨å‡½æ•°
- **ç¦æ­¢å±é™©æ“ä½œ**: é€šè¿‡é™åˆ¶å†…ç½®å‡½æ•°ï¼Œé—´æ¥ç¦æ­¢ `eval()`, `exec()`, `open()`, `__import__()` ç­‰
- **è¾“å…¥éªŒè¯**: ä½¿ç”¨ `eval()` è§£ææµ‹è¯•ç”¨ä¾‹è¾“å…¥æ—¶ï¼Œä¼ å…¥ç©ºçš„ `__builtins__`ï¼Œé˜²æ­¢ä»£ç æ³¨å…¥
- **å¼‚å¸¸æ•è·**: æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œé˜²æ­¢æ¶æ„ä»£ç å¯¼è‡´ç³»ç»Ÿå´©æºƒ
- **æ—¶é—´é™åˆ¶**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½æœ‰æ‰§è¡Œæ—¶é—´é™åˆ¶ï¼Œé˜²æ­¢æ— é™å¾ªç¯

**æ³¨æ„**: å½“å‰å®ç°ä½¿ç”¨è¿›ç¨‹å†…æ‰§è¡Œï¼Œæœªæ¥å¯æ‰©å±•ä¸ºè¿›ç¨‹éš”ç¦»ï¼ˆå¦‚ä½¿ç”¨ `subprocess` æˆ– Docker å®¹å™¨ï¼‰ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚

### 5.6 API æ¥å£å®ç°

**åç«¯è·¯ç”±** (`app.py`):

1. **è·å–é¢˜ç›®åˆ—è¡¨**: `GET /api/oj/problems`
   - æ‰«æ `Data/` ç›®å½•ä¸‹çš„ `problem_*.json` æ–‡ä»¶
   - è¿”å›é¢˜ç›®IDã€æ ‡é¢˜ã€æè¿°æ‘˜è¦

2. **è·å–é¢˜ç›®è¯¦æƒ…**: `GET /api/oj/problem/<problem_id>`
   - è°ƒç”¨ `judge_engine.load_problem(problem_id)`
   - è¿”å›å®Œæ•´çš„é¢˜ç›®ä¿¡æ¯ï¼ˆä¸å«æµ‹è¯•ç”¨ä¾‹ï¼‰

3. **æäº¤ä»£ç åˆ¤é¢˜**: `POST /api/oj/submit`
   - éªŒè¯ç”¨æˆ·ç™»å½•çŠ¶æ€ï¼ˆ`@login_required`ï¼‰
   - è°ƒç”¨ `judge_engine.judge(problem_id, code)`
   - ä¿å­˜æäº¤è®°å½•åˆ°æ•°æ®åº“
   - è¿”å›åˆ¤é¢˜ç»“æœ

4. **è·å–æäº¤å†å²**: `GET /api/oj/submissions?problem_id=<id>`
   - æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„æäº¤è®°å½•
   - æ”¯æŒæŒ‰é¢˜ç›®IDç­›é€‰
   - æŒ‰æäº¤æ—¶é—´å€’åºï¼Œé™åˆ¶è¿”å›20æ¡

5. **æ¸…ç©ºæäº¤å†å²**: `POST /api/oj/submissions/clear`
   - åˆ é™¤æŒ‡å®šé¢˜ç›®çš„æ‰€æœ‰æäº¤è®°å½•
   - è¿”å›åˆ é™¤çš„è®°å½•æ•°

---

## 6. å‰ç«¯é¡µé¢è®¾è®¡

### 6.1 OJ ä¸»é¡µ (`/oj`) - å•é¡µåº”ç”¨è®¾è®¡

**é¡µé¢è·¯ç”±**: `GET /oj` (éœ€è¦ç™»å½•)

**è®¾è®¡ç†å¿µ**: é‡‡ç”¨**å•é¡µåº”ç”¨ï¼ˆSPAï¼‰**è®¾è®¡ï¼Œæ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨ä¸€ä¸ªé¡µé¢ï¼Œé€šè¿‡åŠ¨æ€åŠ è½½å®ç°é¢˜ç›®åˆ‡æ¢ï¼Œæä¾›æµç•…çš„ç”¨æˆ·ä½“éªŒã€‚

**é¡µé¢å¸ƒå±€**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ† åšé¢˜è®­ç»ƒ  [èƒœåˆ©ç»“ç®—åŠ¨ç”»å¼€å…³]  [é¢˜ç›®é€‰æ‹©] [åˆ·æ–°] [æäº¤å†å²] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  é¢˜ç›®è¯¦æƒ…                â”‚  ä»£ç æäº¤                      â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ é¢˜ç›®æ ‡é¢˜            â”‚â”‚  â”‚ [æ ¼å¼åŒ–] [æäº¤åˆ¤é¢˜]      â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ ID: 1               â”‚â”‚  â”‚                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚â”‚  â”‚ [CodeMirror ç¼–è¾‘å™¨]     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ é¢˜ç›®æè¿°            â”‚â”‚  â”‚                         â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ ç¤ºä¾‹:               â”‚â”‚  â”‚ è¿è¡Œ/åˆ¤é¢˜ç»“æœ            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ è¾“å…¥: "babad"       â”‚â”‚  â”‚ [æŸ¥çœ‹é”™è¯¯è¯¦æƒ…] [æ¸…ç©º]   â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ è¾“å‡º: "bab"         â”‚â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚â”‚  â”‚ â”‚ çŠ¶æ€: AC             â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ å‡½æ•°å:             â”‚â”‚  â”‚ â”‚ é€šè¿‡ç”¨ä¾‹: 2/2        â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ longestPalindrome   â”‚â”‚  â”‚ â”‚ æ‰§è¡Œæ—¶é—´: 0.023 ms  â”‚ â”‚ â”‚ â”‚
â”‚  â”‚  â”‚                     â”‚â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚ [å¤±è´¥ç”¨ä¾‹è¯¦æƒ…é¢æ¿]      â”‚ â”‚ â”‚
â”‚  â”‚                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### 6.2.1 é¢˜ç›®é€‰æ‹©ä¸åŠ è½½

**åŠŸèƒ½**:
- ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼šæ˜¾ç¤ºæ‰€æœ‰å¯ç”¨é¢˜ç›®ï¼ˆæ ¼å¼ï¼š`ID. é¢˜ç›®æ ‡é¢˜`ï¼‰
- åˆ·æ–°æŒ‰é’®ï¼šé‡æ–°åŠ è½½é¢˜ç›®åˆ—è¡¨
- è‡ªåŠ¨åŠ è½½ï¼šé¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–é¢˜ç›®åˆ—è¡¨å¹¶é€‰ä¸­ç¬¬ä¸€é¢˜

**å®ç°**:
- ä½¿ç”¨ `fetch('/api/oj/problems')` è·å–é¢˜ç›®åˆ—è¡¨
- åŠ¨æ€æ¸²æŸ“ä¸‹æ‹‰é€‰æ‹©æ¡†
- åˆ‡æ¢é¢˜ç›®æ—¶è‡ªåŠ¨åŠ è½½é¢˜ç›®è¯¦æƒ…å’Œæäº¤å†å²

#### 6.2.2 é¢˜ç›®è¯¦æƒ…å±•ç¤º

**æ˜¾ç¤ºå†…å®¹**:
- é¢˜ç›®æ ‡é¢˜ï¼ˆH5 æ ‡é¢˜ï¼‰
- é¢˜ç›®IDï¼ˆå¾½ç« æ˜¾ç¤ºï¼‰
- é¢˜ç›®æè¿°ï¼ˆæ”¯æŒæ¢è¡Œå’Œæ ¼å¼åŒ–ï¼‰
- ç¤ºä¾‹è¾“å…¥è¾“å‡ºï¼ˆä»£ç å—æ ·å¼ï¼‰
- å‡½æ•°åï¼ˆä»£ç å—æ ·å¼ï¼‰

**æ ·å¼ç‰¹ç‚¹**:
- ä»£ç å—ä½¿ç”¨å·¦ä¾§è¾¹æ¡†é«˜äº®ï¼ˆ4px ç°è‰²è¾¹æ¡†ï¼‰
- æœ€å°é«˜åº¦ 320pxï¼Œè¶…å‡ºåè‡ªé€‚åº”
- æ”¯æŒ Markdown æ¸²æŸ“ï¼ˆå¦‚ä½¿ç”¨ markdown-itï¼‰

#### 6.2.3 ä»£ç ç¼–è¾‘å™¨

**æŠ€æœ¯æ ˆ**: CodeMirror 5.x

**é…ç½®**:
```javascript
{
    mode: 'python',
    theme: 'monokai',
    lineNumbers: true,
    indentUnit: 4,
    tabSize: 4,
    lineWrapping: true,
    autoCloseBrackets: true,
    matchBrackets: true,
    placeholder: "# åœ¨è¿™é‡Œç¼–å†™è§£é¢˜ä»£ç \nprint('Hello OJ')"
}
```

**å¿«æ·é”®**:
- `Ctrl+Enter`: å¿«é€Ÿæäº¤ä»£ç 

**ä»£ç è‰ç¨¿åŠŸèƒ½**:
- **è‡ªåŠ¨ä¿å­˜**: ç¼–è¾‘æ—¶è‡ªåŠ¨ä¿å­˜åˆ° `sessionStorage`ï¼ˆé˜²æŠ–400msï¼‰
- **æŒ‰é¢˜ç›®éš”ç¦»**: æ¯ä¸ªé¢˜ç›®çš„è‰ç¨¿ç‹¬ç«‹å­˜å‚¨
- **æŒ‰ç”¨æˆ·éš”ç¦»**: ä½¿ç”¨ç”¨æˆ·IDä½œä¸ºé”®çš„ä¸€éƒ¨åˆ†ï¼Œé¿å…å¤šç”¨æˆ·å†²çª
- **è‡ªåŠ¨æ¢å¤**: åˆ‡æ¢é¢˜ç›®æ—¶è‡ªåŠ¨æ¢å¤è¯¥é¢˜ç›®çš„è‰ç¨¿

**å®ç°ç»†èŠ‚**:
```javascript
// è‰ç¨¿é”®æ ¼å¼: oj_draft_{userId}_{problemId}
function getDraftKey(problemId) {
    const uidPart = currentUserId ? String(currentUserId) : 'guest';
    return `oj_draft_${uidPart}_${problemId}`;
}

// è‡ªåŠ¨ä¿å­˜ï¼ˆé˜²æŠ–ï¼‰
codeMirrorEditor.on('change', function() {
    if (draftSaveTimer) clearTimeout(draftSaveTimer);
    draftSaveTimer = setTimeout(function() {
        saveDraft(currentProblemId, codeMirrorEditor.getValue());
    }, 400);
});
```

#### 6.2.4 åˆ¤é¢˜ç»“æœæ˜¾ç¤º

**æ˜¾ç¤ºåŒºåŸŸ**:
- çŠ¶æ€å¾½ç« ï¼ˆAC/WA/TLE/RE/CEï¼Œä¸åŒé¢œè‰²ï¼‰
- é€šè¿‡ç”¨ä¾‹æ•° / æ€»ç”¨ä¾‹æ•°
- æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
- é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœ‰ï¼‰

**å¤±è´¥ç”¨ä¾‹è¯¦æƒ…é¢æ¿**:
- å¯æŠ˜å /å±•å¼€
- æ˜¾ç¤ºå¤±è´¥ç”¨ä¾‹çš„ï¼š
  - è¾“å…¥ï¼ˆInputï¼‰
  - æœŸæœ›è¾“å‡ºï¼ˆExpectedï¼‰
  - å®é™…è¾“å‡ºï¼ˆActualï¼‰
  - é”™è¯¯ä¿¡æ¯ï¼ˆErrorï¼‰

**çŠ¶æ€é¢œè‰²æ˜ å°„**:
- `AC`: ç»¿è‰² (`bg-success`)
- `WA`: çº¢è‰² (`badge-wa`)
- `TLE`: é»„è‰² (`bg-warning`)
- `RE`: ç°è‰² (`bg-secondary`)
- `CE`: è“è‰² (`bg-info`)

#### 6.2.5 æäº¤å†å²åŠŸèƒ½

**è§¦å‘æ–¹å¼**: ç‚¹å‡»"æäº¤å†å²"æŒ‰é’®ï¼Œæ‰“å¼€ Bootstrap Modal

**åŠŸèƒ½ç‰¹æ€§**:
- **çŠ¶æ€ç­›é€‰**: ä¸‹æ‹‰é€‰æ‹©æ¡†ç­›é€‰ï¼ˆå…¨éƒ¨/AC/WA/TLE/RE/CEï¼‰
- **åˆ†é¡µæ˜¾ç¤º**: æœ€å¤šæ˜¾ç¤º20æ¡è®°å½•
- **è¯¦ç»†ä¿¡æ¯**: æ˜¾ç¤ºæäº¤IDã€çŠ¶æ€ã€æ—¶é—´ã€é€šè¿‡ç”¨ä¾‹æ•°ã€æ‰§è¡Œæ—¶é—´ã€é”™è¯¯ä¿¡æ¯ã€å®Œæ•´ä»£ç 
- **ä»£ç é¢„è§ˆ**: ä»£ç åŒºåŸŸå¯æ»šåŠ¨ï¼Œæœ€å¤§é«˜åº¦ 14em

**æäº¤è®°å½•å¡ç‰‡æ ·å¼**:
- å·¦ä¾§è¾¹æ¡†é¢œè‰²æ ¹æ®çŠ¶æ€å˜åŒ–
- æ‚¬åœæ—¶èƒŒæ™¯è‰²å˜åŒ–
- ä»£ç åŒºåŸŸä½¿ç”¨æ·±è‰²ä¸»é¢˜ï¼ˆ`bg-dark text-light`ï¼‰

#### 6.2.6 èƒœåˆ©åº†ç¥åŠ¨ç”» ğŸ‰

**æŠ€æœ¯äº®ç‚¹**: ç³»ç»Ÿå®ç°äº†ä¸°å¯Œçš„åº†ç¥åŠ¨ç”»æ•ˆæœï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚

**åŠŸèƒ½å¼€å…³**:

- é¡µé¢é¡¶éƒ¨æä¾›å¼€å…³ï¼ˆé»˜è®¤å¼€å¯ï¼‰
- çŠ¶æ€æŒä¹…åŒ–åˆ° `sessionStorage`

**åŠ¨ç”»æ•ˆæœ**:
1. **Canvas ç²’å­åŠ¨ç”»**:
   - ä½¿ç”¨ HTML5 Canvas ç»˜åˆ¶å½©è‰²ç²’å­
   - ç²’å­ä»ä¸­å¿ƒå‘å››å‘¨æ‰©æ•£
   - æ”¯æŒé«˜ DPI å±å¹•ï¼ˆdevicePixelRatio é€‚é…ï¼‰
   - æŒç»­6ç§’ï¼Œå¸¦æ¸éšæ•ˆæœ

2. **è¾¹ç¼˜å½©è™¹åŠ¨ç”»**:
   - å·¦å³ä¸¤ä¾§æ»‘å…¥å½©è™¹æ¸å˜æ¡
   - ä½¿ç”¨ CSS åŠ¨ç”»å’Œæ··åˆæ¨¡å¼

3. **æ–‡å­—åŠ¨ç”»**:
   - "ALL RIGHT!" å¤§æ ‡é¢˜ï¼ˆ6vw å­—ä½“ï¼‰
   - å¼¹å…¥åŠ¨ç”»ï¼ˆscale + opacityï¼‰
   - è„‰å†²åŠ¨ç”»ï¼ˆæŒç»­ç¼©æ”¾ï¼‰

4. **éŸ³æ•ˆ**:
   - æ’­æ”¾èƒœåˆ©éŸ³æ•ˆï¼ˆ`/static/mp3/bgm.mp3`ï¼‰
   - éŸ³é‡ 0.6ï¼Œ6ç§’åè‡ªåŠ¨åœæ­¢

**å®ç°æŠ€æœ¯**:
- Canvas API + RequestAnimationFrame
- CSS3 åŠ¨ç”»ï¼ˆkeyframesï¼‰
- Web Audio API

**è§¦å‘æ¡ä»¶**: å½“åˆ¤é¢˜ç»“æœä¸º `AC` ä¸”ç”¨æˆ·å¼€å¯åº†ç¥åŠŸèƒ½æ—¶è‡ªåŠ¨è§¦å‘

### 6.3 ç”¨æˆ·äº¤äº’æµç¨‹

```
ç”¨æˆ·è¿›å…¥é¡µé¢
    â†“
åŠ è½½é¢˜ç›®åˆ—è¡¨ â†’ é€‰ä¸­ç¬¬ä¸€é¢˜
    â†“
åŠ è½½é¢˜ç›®è¯¦æƒ… + æ¢å¤è‰ç¨¿ï¼ˆå¦‚æœ‰ï¼‰
    â†“
ç”¨æˆ·ç¼–å†™ä»£ç  â†’ è‡ªåŠ¨ä¿å­˜è‰ç¨¿
    â†“
ç‚¹å‡»"æäº¤åˆ¤é¢˜" â†’ æ˜¾ç¤º"åˆ¤é¢˜ä¸­..."
    â†“
æ¥æ”¶åˆ¤é¢˜ç»“æœ
    â†“
â”œâ”€â†’ AC: æ˜¾ç¤ºæˆåŠŸ + æ’­æ”¾åº†ç¥åŠ¨ç”»
â””â”€â†’ å…¶ä»–: æ˜¾ç¤ºçŠ¶æ€ + é”™è¯¯è¯¦æƒ…ï¼ˆå¯å±•å¼€ï¼‰
    â†“
è‡ªåŠ¨åˆ·æ–°æäº¤å†å²
```

### 6.4 å“åº”å¼è®¾è®¡

- **æ¡Œé¢ç«¯**: å·¦å³åˆ†æ å¸ƒå±€ï¼ˆé¢˜ç›®è¯¦æƒ… | ä»£ç ç¼–è¾‘å™¨ï¼‰
- **ç§»åŠ¨ç«¯**: ä¸Šä¸‹å †å å¸ƒå±€ï¼ˆé€šè¿‡ Bootstrap æ …æ ¼ç³»ç»Ÿå®ç°ï¼‰
- **ä»£ç ç¼–è¾‘å™¨**: æœ€å°é«˜åº¦ 260pxï¼Œè‡ªé€‚åº”å†…å®¹
- **ç»“æœåŒºåŸŸ**: æœ€å¤§é«˜åº¦ 360pxï¼Œè¶…å‡ºå¯æ»šåŠ¨

---

## 7. æŠ€æœ¯äº®ç‚¹

### 7.1 å‡½æ•°æ¨¡å¼åˆ¤é¢˜å¼•æ“

**åˆ›æ–°ç‚¹**: é‡‡ç”¨å‡½æ•°æ¨¡å¼è€Œéè„šæœ¬æ¨¡å¼æ‰§è¡Œç”¨æˆ·ä»£ç ã€‚

**ä¼˜åŠ¿**:
- æ›´ç¬¦åˆç®—æ³•é¢˜ç›®çš„è§£é¢˜æ¨¡å¼ï¼ˆLeetCode é£æ ¼ï¼‰
- ä¾¿äºæµ‹è¯•ç”¨ä¾‹çš„ç»Ÿä¸€ç®¡ç†å’Œæ‰§è¡Œ
- é¿å…è„šæœ¬æ‰§è¡Œå¸¦æ¥çš„å‰¯ä½œç”¨ï¼ˆå…¨å±€å˜é‡æ±¡æŸ“ç­‰ï¼‰
- ç»“æœæ¯”å¯¹æ›´ç²¾ç¡®ï¼ˆç›´æ¥æ¯”è¾ƒå‡½æ•°è¿”å›å€¼ï¼‰

**å®ç°**: é€šè¿‡ `exec()` æ‰§è¡Œä»£ç å®šä¹‰å‡½æ•°ï¼Œç„¶åè°ƒç”¨æŒ‡å®šå‡½æ•°åï¼Œä¼ å…¥æµ‹è¯•ç”¨ä¾‹å‚æ•°ã€‚

### 7.2 æ··åˆå­˜å‚¨æ¶æ„

**è®¾è®¡**: é¢˜ç›®æ•°æ®å­˜å‚¨åœ¨ JSON æ–‡ä»¶ï¼Œæäº¤è®°å½•å­˜å‚¨åœ¨æ•°æ®åº“ã€‚

**ä¼˜åŠ¿**:
- **é¢˜ç›®æ•°æ®**: JSON æ–‡ä»¶ä¾¿äºç‰ˆæœ¬ç®¡ç†ã€å¿«é€Ÿè¿­ä»£ã€æ— éœ€æ•°æ®åº“è¿ç§»
- **æäº¤è®°å½•**: æ•°æ®åº“ä¿è¯æ•°æ®æŒä¹…åŒ–ã€æ”¯æŒå¤æ‚æŸ¥è¯¢ã€ä¾¿äºç»Ÿè®¡åˆ†æ
- **æ‰©å±•æ€§**: æœªæ¥å¯è½»æ¾è¿ç§»é¢˜ç›®æ•°æ®åˆ°æ•°æ®åº“

### 7.3 ä»£ç è‰ç¨¿è‡ªåŠ¨ä¿å­˜

**åŠŸèƒ½**: ç”¨æˆ·ç¼–å†™çš„ä»£ç è‡ªåŠ¨ä¿å­˜åˆ° `sessionStorage`ï¼ŒæŒ‰é¢˜ç›®å’Œç”¨æˆ·éš”ç¦»ã€‚

**æŠ€æœ¯ç»†èŠ‚**:
- é˜²æŠ–æœºåˆ¶ï¼ˆ400msï¼‰é¿å…é¢‘ç¹å†™å…¥
- æŒ‰ç”¨æˆ·IDå’Œé¢˜ç›®IDç»„åˆé”®ï¼Œå®ç°å¤šç”¨æˆ·ã€å¤šé¢˜ç›®éš”ç¦»
- åˆ‡æ¢é¢˜ç›®æ—¶è‡ªåŠ¨æ¢å¤è‰ç¨¿ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

**å®ç°**:
```javascript
// è‰ç¨¿é”®: oj_draft_{userId}_{problemId}
// è‡ªåŠ¨ä¿å­˜: CodeMirror change äº‹ä»¶ + é˜²æŠ–
// è‡ªåŠ¨æ¢å¤: åˆ‡æ¢é¢˜ç›®æ—¶ä» sessionStorage è¯»å–
```

### 7.4 å®‰å…¨çš„ä»£ç æ‰§è¡Œç¯å¢ƒ

**å®‰å…¨ç­–ç•¥**:
- **å—é™å†…ç½®å‡½æ•°**: ä»…å…è®¸å®‰å…¨çš„å†…ç½®å‡½æ•°ï¼ˆç™½åå•æœºåˆ¶ï¼‰
- **ç¦æ­¢å±é™©æ“ä½œ**: é€šè¿‡é™åˆ¶å†…ç½®å‡½æ•°ï¼Œé—´æ¥ç¦æ­¢ `eval()`, `exec()`, `open()`, `__import__()` ç­‰
- **è¾“å…¥éªŒè¯**: è§£ææµ‹è¯•ç”¨ä¾‹è¾“å…¥æ—¶ä½¿ç”¨ç©ºçš„ `__builtins__`ï¼Œé˜²æ­¢ä»£ç æ³¨å…¥
- **å¼‚å¸¸æ•è·**: æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œé˜²æ­¢æ¶æ„ä»£ç å¯¼è‡´ç³»ç»Ÿå´©æºƒ
- **æ—¶é—´é™åˆ¶**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½æœ‰æ‰§è¡Œæ—¶é—´é™åˆ¶ï¼ˆé»˜è®¤1.0ç§’ï¼‰

**æœªæ¥æ‰©å±•**: å¯å‡çº§ä¸ºè¿›ç¨‹éš”ç¦»ï¼ˆDocker å®¹å™¨ï¼‰ä»¥å¢å¼ºå®‰å…¨æ€§ã€‚

### 7.5 ä¸°å¯Œçš„ç”¨æˆ·åé¦ˆæœºåˆ¶

**å¤šç»´åº¦åé¦ˆ**:
1. **å³æ—¶åé¦ˆ**: æäº¤åç«‹å³æ˜¾ç¤ºåˆ¤é¢˜ç»“æœ
2. **è¯¦ç»†é”™è¯¯ä¿¡æ¯**: å¤±è´¥ç”¨ä¾‹çš„è¾“å…¥ã€æœŸæœ›ã€å®é™…è¾“å‡ºã€é”™è¯¯ä¿¡æ¯
3. **çŠ¶æ€å¯è§†åŒ–**: ä¸åŒçŠ¶æ€ä½¿ç”¨ä¸åŒé¢œè‰²å¾½ç« 
4. **åº†ç¥åŠ¨ç”»**: AC æ—¶æ’­æ”¾ Canvas ç²’å­åŠ¨ç”» + éŸ³æ•ˆ
5. **æäº¤å†å²**: å®Œæ•´çš„æäº¤è®°å½•ï¼Œæ”¯æŒçŠ¶æ€ç­›é€‰

### 7.6 å•é¡µåº”ç”¨ï¼ˆSPAï¼‰è®¾è®¡

**ä¼˜åŠ¿**:
- æµç•…çš„ç”¨æˆ·ä½“éªŒï¼Œæ— éœ€é¡µé¢åˆ·æ–°
- å¿«é€Ÿåˆ‡æ¢é¢˜ç›®ï¼Œä¿æŒä»£ç ç¼–è¾‘çŠ¶æ€
- å‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼Œå‰ç«¯åŠ¨æ€åŠ è½½æ•°æ®

**æŠ€æœ¯å®ç°**:
- ä½¿ç”¨åŸç”Ÿ JavaScript + Fetch API
- åŠ¨æ€ DOM æ“ä½œæ›´æ–°é¡µé¢å†…å®¹
- CodeMirror ç¼–è¾‘å™¨çŠ¶æ€ä¿æŒ

### 7.7 é«˜æ€§èƒ½åˆ¤é¢˜æµç¨‹

**ä¼˜åŒ–ç­–ç•¥**:
- **çŸ­è·¯æ‰§è¡Œ**: é‡åˆ°ç¬¬ä¸€ä¸ªå¤±è´¥ç”¨ä¾‹å³åœæ­¢ï¼Œä¸æ‰§è¡Œåç»­ç”¨ä¾‹
- **æ—¶é—´ç»Ÿè®¡**: è®°å½•æ¯ä¸ªç”¨ä¾‹çš„æ‰§è¡Œæ—¶é—´ï¼Œå–æœ€å¤§å€¼
- **ç»“æœç¼“å­˜**: å‰ç«¯ç¼“å­˜æäº¤å†å²ï¼Œå‡å°‘é‡å¤è¯·æ±‚

### 7.8 å“åº”å¼å‰ç«¯è®¾è®¡

**é€‚é…æ–¹æ¡ˆ**:
- Bootstrap 5 æ …æ ¼ç³»ç»Ÿ
- ç§»åŠ¨ç«¯å‹å¥½çš„å¸ƒå±€ï¼ˆä¸Šä¸‹å †å ï¼‰
- ä»£ç ç¼–è¾‘å™¨è‡ªé€‚åº”é«˜åº¦
- ç»“æœåŒºåŸŸå¯æ»šåŠ¨ï¼Œé˜²æ­¢å†…å®¹æº¢å‡º

---

## 8. è¿è¡Œé€»è¾‘è¯¦è§£

### 8.1 ç”¨æˆ·æäº¤ä»£ç å®Œæ•´æµç¨‹

**æµç¨‹å›¾**:
```
å‰ç«¯ (oj_home.html)
    â†“
ç”¨æˆ·ç‚¹å‡»"æäº¤åˆ¤é¢˜"æŒ‰é’®
    â†“
JavaScript: submitCurrentCode()
    â†“
POST /api/oj/submit
{
  "problem_id": "1",
  "code": "def longestPalindrome(s):\n    ..."
}
    â†“
åç«¯ (app.py)
    â†“
@login_required éªŒè¯ç™»å½•
    â†“
è°ƒç”¨ judge_engine.judge(problem_id, code)
    â†“
åˆ¤é¢˜å¼•æ“ (utils/judge.py)
    â†“
â”œâ”€â†’ load_problem(problem_id)  # åŠ è½½é¢˜ç›®JSON
â”œâ”€â†’ load_testcases(problem_id)  # åŠ è½½æµ‹è¯•ç”¨ä¾‹JSON
â””â”€â†’ éå†æµ‹è¯•ç”¨ä¾‹
    â”‚
    â”œâ”€â†’ run_function_mode(code, function_name, test_input)
    â”‚   â”‚
    â”‚   â”œâ”€â†’ åˆ›å»ºå—é™æ‰§è¡Œç¯å¢ƒ
    â”‚   â”œâ”€â†’ exec(code, exec_globals)  # æ‰§è¡Œä»£ç å®šä¹‰å‡½æ•°
    â”‚   â”œâ”€â†’ æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
    â”‚   â”œâ”€â†’ è§£ææµ‹è¯•ç”¨ä¾‹è¾“å…¥: args = eval(test_input)
    â”‚   â”œâ”€â†’ è°ƒç”¨ç”¨æˆ·å‡½æ•°: output = user_function(*args)
    â”‚   â””â”€â†’ æ£€æŸ¥æ‰§è¡Œæ—¶é—´æ˜¯å¦è¶…é™
    â”‚
    â”œâ”€â†’ compare_output(user_output, expected_output)
    â”‚
    â””â”€â†’ è®°å½•ç»“æœ
        â”œâ”€â†’ é€šè¿‡: ç»§ç»­ä¸‹ä¸€ä¸ªç”¨ä¾‹
        â””â”€â†’ å¤±è´¥: è®°å½•å¤±è´¥ä¿¡æ¯ï¼Œåœæ­¢æ‰§è¡Œ
    â†“
è¿”å›åˆ¤é¢˜ç»“æœ
{
  "success": true,
  "status": "AC" | "WA" | "TLE" | "RE",
  "passed": 2,
  "total": 2,
  "execution_time": 0.023,
  "failed_case": {...}  # å¦‚æœ‰å¤±è´¥
}
    â†“
ä¿å­˜æäº¤è®°å½•åˆ°æ•°æ®åº“
    â†“
Submission(
    user_id=user_id,
    problem_id=problem_id,
    code=code,
    status=judge_result['status'],
    passed_cases=judge_result['passed'],
    total_cases=judge_result['total'],
    error_message=json.dumps(judge_result.get('failed_case')),
    execution_time=judge_result['execution_time']
)
    â†“
db.session.add(submission)
db.session.commit()
    â†“
è¿”å› JSON å“åº”ç»™å‰ç«¯
    â†“
å‰ç«¯æ›´æ–°UI
    â”œâ”€â†’ æ˜¾ç¤ºåˆ¤é¢˜ç»“æœ
    â”œâ”€â†’ æ˜¾ç¤ºå¤±è´¥ç”¨ä¾‹è¯¦æƒ…ï¼ˆå¦‚æœ‰ï¼‰
    â”œâ”€â†’ æ’­æ”¾åº†ç¥åŠ¨ç”»ï¼ˆå¦‚ ACï¼‰
    â””â”€â†’ åˆ·æ–°æäº¤å†å²
```

### 8.2 åˆ¤é¢˜å¼•æ“æ ¸å¿ƒä»£ç é€»è¾‘

**å‡½æ•°æ¨¡å¼æ‰§è¡Œ** (`utils/judge.py`):
```python
def run_function_mode(self, code, function_name, test_input, time_limit=1.0):
    """å‡½æ•°æ¨¡å¼æ‰§è¡Œä»£ç """
    # 1. åˆ›å»ºå—é™çš„æ‰§è¡Œç¯å¢ƒ
    exec_globals = {
        '__builtins__': {
            'len': len, 'range': range, 'list': list,
            'dict': dict, 'set': set, 'tuple': tuple,
            # ... æ›´å¤šå®‰å…¨çš„å†…ç½®å‡½æ•°
        }
    }
    
    # 2. æ‰§è¡Œç”¨æˆ·ä»£ç ï¼ˆå®šä¹‰å‡½æ•°ï¼‰
    exec(code, exec_globals)
    
    # 3. æ£€æŸ¥å‡½æ•°æ˜¯å¦å­˜åœ¨
    if function_name not in exec_globals:
        return {'error': f'å‡½æ•° {function_name} æœªå®šä¹‰'}
    
    # 4. è·å–ç”¨æˆ·å‡½æ•°
    user_function = exec_globals[function_name]
    
    # 5. è§£ææµ‹è¯•ç”¨ä¾‹è¾“å…¥ï¼ˆå®‰å…¨è§£æï¼‰
    args = eval(test_input, {"__builtins__": {}})
    if not isinstance(args, (list, tuple)):
        args = (args,)
    
    # 6. è°ƒç”¨å‡½æ•°å¹¶è®¡æ—¶
    start_time = time.time()
    output = user_function(*args)
    execution_time = time.time() - start_time
    
    # 7. æ£€æŸ¥æ—¶é—´é™åˆ¶
    if execution_time > time_limit:
        return {'error': f'Time Limit Exceeded (>{time_limit}s)'}
    
    return {
        'success': True,
        'output': output,
        'execution_time': execution_time
    }
```

**åˆ¤é¢˜ä¸»å‡½æ•°** (`utils/judge.py`):
```python
def judge(self, problem_id, code):
    """åˆ¤é¢˜ä¸»å‡½æ•°"""
    # 1. åŠ è½½é¢˜ç›®å’Œæµ‹è¯•ç”¨ä¾‹
    problem = self.load_problem(problem_id)
    testcases = self.load_testcases(problem_id)
    function_name = problem.get('function_name')
    
    # 2. åˆå§‹åŒ–ç»“æœ
    result = {
        'success': True,
        'status': 'AC',
        'passed': 0,
        'total': len(testcases),
        'failed_case': None,
        'execution_time': 0,
        'details': []
    }
    
    # 3. éå†æµ‹è¯•ç”¨ä¾‹ï¼ˆçŸ­è·¯æ‰§è¡Œï¼‰
    for idx, testcase in enumerate(testcases):
        test_input = testcase['input']
        expected_output = testcase['expected_output']
        
        # 4. æ‰§è¡Œä»£ç 
        run_result = self.run_function_mode(
            code, function_name, test_input, time_limit
        )
        
        # 5. æ£€æŸ¥æ‰§è¡Œç»“æœ
        if not run_result['success']:
            # æ‰§è¡Œå¤±è´¥ï¼ˆTLE æˆ– REï¼‰
            result['status'] = 'TLE' if 'Time Limit' in run_result['error'] else 'RE'
            result['failed_case'] = {
                'case_id': idx + 1,
                'input': test_input,
                'expected': expected_output,
                'error': run_result['error']
            }
            break
        
        # 6. æ¯”å¯¹è¾“å‡º
        if self.compare_output(run_result['output'], expected_output):
            # é€šè¿‡
            result['passed'] += 1
        else:
            # ç­”æ¡ˆé”™è¯¯
            result['status'] = 'WA'
            result['failed_case'] = {
                'case_id': idx + 1,
                'input': test_input,
                'expected': expected_output,
                'actual': run_result['output']
            }
            break
        
        # 7. æ›´æ–°æ‰§è¡Œæ—¶é—´ï¼ˆå–æœ€å¤§å€¼ï¼‰
        result['execution_time'] = max(
            result['execution_time'],
            run_result['execution_time']
        )
    
    return result
```

### 8.3 é¢˜ç›®æ•°æ®åŠ è½½

**é¢˜ç›®æ–‡ä»¶æ ¼å¼** (`Data/problem_*.json`):
```json
{
  "id": 1,
  "title": "æœ€é•¿å›æ–‡å­ä¸²",
  "description": "ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² sï¼Œæ‰¾åˆ° s ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²...",
  "example": {
    "input": "\"babad\"",
    "output": "\"bab\""
  },
  "function_name": "longestPalindrome"
}
```

**æµ‹è¯•ç”¨ä¾‹æ–‡ä»¶æ ¼å¼** (`Data/test_case_*.json`):
```json
{
  "problem_id": 1,
  "testcases": [
    {
      "input": "'babad'",
      "expected_output": "bab"
    },
    {
      "input": "'cbbd'",
      "expected_output": "bb"
    }
  ]
}
```

**åŠ è½½é€»è¾‘**:
```python
def load_problem(self, problem_id):
    """ä»JSONæ–‡ä»¶åŠ è½½é¢˜ç›®"""
    problem_file = os.path.join(self.data_dir, f'problem_{problem_id}.json')
    with open(problem_file, 'r', encoding='utf-8') as f:
        return json.load(f)

def load_testcases(self, problem_id):
    """ä»JSONæ–‡ä»¶åŠ è½½æµ‹è¯•ç”¨ä¾‹"""
    testcase_file = os.path.join(self.data_dir, f'test_case_{problem_id}.json')
    with open(testcase_file, 'r', encoding='utf-8') as f:
        data = json.load(f)
        return data.get('testcases', [])
```

---

## 8. æ‰©å±•åŠŸèƒ½è®¾è®¡

### 8.1 é¢˜ç›®éš¾åº¦åˆ†çº§
- **ç®€å• (Easy)**: åŸºç¡€è¯­æ³•ç»ƒä¹ 
- **ä¸­ç­‰ (Medium)**: ç®—æ³•åº”ç”¨
- **å›°éš¾ (Hard)**: å¤æ‚ç®—æ³•å’Œä¼˜åŒ–

### 8.2 ç”¨æˆ·æ’è¡Œæ¦œ
```sql
-- ç»Ÿè®¡ç”¨æˆ·é€šè¿‡é¢˜ç›®æ•°
SELECT user_id, COUNT(DISTINCT problem_id) as solved_count
FROM submission
WHERE status = 'Accepted'
GROUP BY user_id
ORDER BY solved_count DESC;
```

### 8.3 ä»£ç è´¨é‡è¯„åˆ†
- æ—¶é—´å¤æ‚åº¦åˆ†æ
- ç©ºé—´å¤æ‚åº¦åˆ†æ
- ä»£ç é£æ ¼æ£€æŸ¥ (PEP8)

### 8.4 è®¨è®ºåŒºåŠŸèƒ½
- é¢˜ç›®è®¨è®º
- é¢˜è§£åˆ†äº«
- ä»£ç è¯„å®¡

---

## 9. æ€§èƒ½ä¼˜åŒ–

### 9.1 æ•°æ®åº“ä¼˜åŒ–
```python
# ä½¿ç”¨ç´¢å¼•åŠ é€ŸæŸ¥è¯¢
submission.query.filter_by(user_id=user_id, problem_id=problem_id).first()

# é™åˆ¶è¿”å›æ•°é‡
submission.query.limit(20).all()

# ä½¿ç”¨ join å‡å°‘æŸ¥è¯¢æ¬¡æ•°
db.session.query(Submission).join(User).filter(...)
```

### 9.2 ç¼“å­˜ç­–ç•¥
```python
# é¢˜ç›®æ•°æ®ç¼“å­˜ (ä½¿ç”¨ Flask-Caching)
@cache.cached(timeout=3600, key_prefix='problem')
def load_problem(problem_id):
    # è¯»å– JSON æ–‡ä»¶
    pass
```

### 9.3 å¼‚æ­¥åˆ¤é¢˜
```python
# ä½¿ç”¨ Celery å®ç°å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—
@celery.task
def async_judge(submission_id):
    submission = Submission.query.get(submission_id)
    result = judge_engine.judge(submission.problem_id, submission.code)
    submission.status = result['status']
    db.session.commit()
```

---

## 10. å®‰å…¨æ€§è€ƒè™‘

### 10.1 ä»£ç æ³¨å…¥é˜²æŠ¤
```python
# ç¦æ­¢å±é™©æ“ä½œ
FORBIDDEN_KEYWORDS = ['__import__', 'eval', 'exec', 'open', 'os.system']

def validate_code(code):
    for keyword in FORBIDDEN_KEYWORDS:
        if keyword in code:
            raise SecurityError(f"ç¦æ­¢ä½¿ç”¨ {keyword}")
```

### 10.2 èµ„æºé™åˆ¶
```python
# é™åˆ¶æ‰§è¡Œæ—¶é—´å’Œå†…å­˜
import resource
resource.setrlimit(resource.RLIMIT_CPU, (5, 5))  # 5ç§’CPUæ—¶é—´
resource.setrlimit(resource.RLIMIT_AS, (128*1024*1024, 128*1024*1024))  # 128MBå†…å­˜
```

### 10.3 ç”¨æˆ·æƒé™æ§åˆ¶
```python
@login_required
def api_submit_code():
    # éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æƒé™æäº¤
    pass
```

---

## 11. é”™è¯¯å¤„ç†

### 11.1 å¸¸è§é”™è¯¯ç±»å‹

| é”™è¯¯ç±»å‹ | HTTPçŠ¶æ€ç  | å¤„ç†æ–¹å¼ |
|---------|-----------|---------|
| æœªç™»å½• | 401 | é‡å®šå‘åˆ°ç™»å½•é¡µ |
| é¢˜ç›®ä¸å­˜åœ¨ | 404 | è¿”å›é”™è¯¯æç¤º |
| ä»£ç ä¸ºç©º | 400 | è¿”å›é”™è¯¯æç¤º |
| æ•°æ®åº“é”™è¯¯ | 500 | å›æ»šäº‹åŠ¡ï¼Œè®°å½•æ—¥å¿— |
| åˆ¤é¢˜è¶…æ—¶ | 200 | è¿”å›TLEçŠ¶æ€ |

### 11.2 å¼‚å¸¸æ•è·ç¤ºä¾‹
```python
try:
    judge_result = judge_engine.judge(problem_id, code)
except TimeoutError:
    return jsonify({'status': 'TLE'})
except MemoryError:
    return jsonify({'status': 'MLE'})
except Exception as e:
    return jsonify({'error': str(e)}), 500
```

---

## 12. æµ‹è¯•æ–¹æ¡ˆ

### 12.1 å•å…ƒæµ‹è¯•
```python
def test_submit_code():
    """æµ‹è¯•ä»£ç æäº¤åŠŸèƒ½"""
    response = client.post('/api/oj/submit', json={
        'problem_id': '1',
        'code': 'def solution(): return [0, 1]'
    })
    assert response.status_code == 200
    assert response.json['success'] == True
```

### 12.2 é›†æˆæµ‹è¯•
- æµ‹è¯•å®Œæ•´æäº¤æµç¨‹
- æµ‹è¯•åˆ¤é¢˜å¼•æ“å‡†ç¡®æ€§
- æµ‹è¯•å¹¶å‘æäº¤

---

## 13. éƒ¨ç½²è¯´æ˜

### 13.1 ç¯å¢ƒè¦æ±‚
- Python 3.8+
- Flask 2.0+
- SQLAlchemy 1.4+
- SQLite 3

### 13.2 é…ç½®æ–‡ä»¶
```python
# config.py
SQLALCHEMY_DATABASE_URI = 'sqlite:///database.db'
SECRET_KEY = 'your-secret-key'
JUDGE_TIMEOUT = 5  # åˆ¤é¢˜è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
MAX_MEMORY = 128   # æœ€å¤§å†…å­˜é™åˆ¶ï¼ˆMBï¼‰
```

### 13.3 å¯åŠ¨å‘½ä»¤
```bash
# åˆå§‹åŒ–æ•°æ®åº“
flask db init
flask db migrate
flask db upgrade

# å¯åŠ¨åº”ç”¨
python app.py
```

---

## 14. æœªæ¥æ”¹è¿›æ–¹å‘

1. **å¤šè¯­è¨€æ”¯æŒ**: æ‰©å±•æ”¯æŒ C++, Java, JavaScript ç­‰è¯­è¨€
2. **å®æ—¶æ’è¡Œæ¦œ**: ä½¿ç”¨ WebSocket å®ç°å®æ—¶æ›´æ–°
3. **AI ä»£ç æç¤º**: é›†æˆ AI åŠ©æ‰‹æä¾›è§£é¢˜æ€è·¯
4. **ç«èµ›æ¨¡å¼**: æ”¯æŒå®šæ—¶æ¯”èµ›å’Œç§¯åˆ†ç³»ç»Ÿ
5. **ç¤¾åŒºåŠŸèƒ½**: æ·»åŠ å…³æ³¨ã€ç‚¹èµã€è¯„è®ºç­‰ç¤¾äº¤åŠŸèƒ½

